### MARS grid

```{python}
#| echo: false
#| output: false
import os
import subprocess
cwd = os.getcwd()

fpath = "developer/grid/_static/mars.py"
subprocess.call(["python", fpath], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
```

In this section, the main features of the MARS grid and the implications in Ichthyop are summarized.

#### Horizontal

In MARS, the 3D structure of the grid is the same as the one in NEMO:

![MARS staggered grid structure](developer/grid/_static/mars_schema_discretisation.jpg)

#### Vertical

The vertical coordinate of the Mars model is called $\sigma$, which varies from -1 at seabed to 0 at the surface. In MARS, if the number of `T` points on the vertical is `kmax`, the number of `W` points is `kmax + 1`. For a given `T` cell located at the `k` index, the corresponding `W` point is located below. `k=0` corresponds to the bottom, while `k=kmax` corresponds to the surface.

![MARS grid structure.](developer/grid/_static/mars_schema_discretisation2.jpg)


The conversion from $\sigma$ to $z$, using generalized $\sigma$ levels, is given in [Dumas (2009)](https://mars3d.ifremer.fr/docs/_static/2009_11_22_DocMARS_GB.pdf) (equation 1.29):

$$
z = \xi (1 + \sigma) + H_c \times [\sigma - C(\sigma)]  + H C(\sigma)
$$

where $\xi$ is the free surface, $H$ is the bottom depth and $H_c$ is either the minimum depth or a shallow water depth above
which we wish to have more resolution. $C$ is defined as (equation 1.30):

$$
C(\sigma) = (1 - \beta) \dfrac{\sinh(\theta \sigma)}{\sinh(\theta)} + \beta \dfrac{\tanh[\theta(\sigma + \frac{1}{2})]-\tanh(\frac{\theta}{2})}{2 \tanh(\frac{\theta}{2})}
$$

However, if the $H_c$ variable is not found, the following formulation will be used:

$$
z = \xi (1 + \sigma) + \sigma H
$$

Note that the $C(\sigma)$ variable is read from the input file.
